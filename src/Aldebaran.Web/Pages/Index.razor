@page "/"@attribute [Authorize]<PageTitle>Index</PageTitle>@inject Microsoft.Extensions.Localization.IStringLocalizer<Index> L@using Aldebaran.Web.Models.ViewModels;@using Aldebaran.Web.Resources.LocalizedControls;@inject Aldebaran.Infraestructure.Common.Utils.ISharedStringLocalizer SharedLocalizer ;<RadzenText Text="Consulta de notificaciones activas" TextStyle="Radzen.Blazor.TextStyle.DisplayH5" TagName="Radzen.Blazor.TagName.Auto"></RadzenText><RadzenSplitter Resize="@OnResize" Orientation="Orientation.Vertical" style="height: 700px; border: 2px solid rgba(0,0,0,.08);">    <RadzenSplitterPane Size="50%" Min="20%" Max="80%">        <RadzenSplitter Orientation="Orientation.Horizontal">            <RadzenSplitterPane Size="50%" Min="20%" Max="80%">                <RadzenCard>                    <RadzenRow class="mb-2">                        <RadzenColumn SizeLG="6" SizeXL="6" SizeMD="6" SizeSM="6" SizeXX="12" SizeXS="12" class="d-flex align-items-end">                            <RadzenText Text="Cantidades mínimas" TextStyle="Radzen.Blazor.TextStyle.H6" TagName="Radzen.Blazor.TagName.Auto" class="p-0 m-0"></RadzenText>                        </RadzenColumn>                        <RadzenColumn SizeLG="6" SizeXL="6" SizeMD="6" SizeSM="6" SizeXX="12" SizeXS="12">                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.End" Gap="1rem" Wrap="FlexWrap.Wrap" JustifyContent="JustifyContent.End">                                <RadzenFormField Variant="Variant.Text">                                    <RadzenDropDown @bind-Value="@MinimumQuantityGridTimer.SelectedTimer" Data="@Timers" ValueProperty="Milliseconds" TextProperty="Description" Name="MinimumQuantityDropDownTimer" Change="@((args)=>MinimumQuantityData_UpdateOnTimerChange(args))" />                                </RadzenFormField>                                <RadzenButton Click="@UpdateMinimumQuantitiesAsync" Icon="refresh" Variant="Variant.Filled" ButtonStyle="ButtonStyle.Primary" Size="ButtonSize.Medium" class="d-flex align-items-end rz-button-icon-only rz-border-radius-10" />                            </RadzenStack>                        </RadzenColumn>                    </RadzenRow>                    <LocalizedDataGrid PageSize="@pageSize" @ref="minimumQuantityArticlesGrid" AllowFiltering="true" AllowPaging="true" AllowSorting="true" ShowPagingSummary="true" Data="@minimumQuantityArticles" TItem="MinimumQuantityArticle" IsLoading="@MinimumQuantityGridTimer.IsLoading">                        <Columns>                            <RadzenDataGridColumn TItem="MinimumQuantityArticle" Property="ArticleName" Title="Referencia" Width="80%" />                            <RadzenDataGridColumn TItem="MinimumQuantityArticle" Title="Cant. Mínima" Width="30%" Filterable="false">                                <Template Context="detail">                                    @detail.MinimumQuantity.ToString("N0")                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="MinimumQuantityArticle" Title="Inventario" Width="30%" Filterable="false">                                <Template Context="detail">                                    @detail.AvailableQuantity.ToString("N0")                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="MinimumQuantityArticle" Title="En Tránsito" Width="30%" Filterable="false">                                <Template Context="detail">                                    @detail.InTransitQuantity.ToString("N0")                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="MinimumQuantityArticle" Title="Reservado" Width="30%" Filterable="false">                                <Template Context="detail">                                    @detail.ReservedQuantity.ToString("N0")                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="MinimumQuantityArticle" Title="Pedido" Width="30%" Filterable="false">                                <Template Context="detail">                                    @detail.OrderedQuantity.ToString("N0")                                </Template>                            </RadzenDataGridColumn>                        </Columns>                    </LocalizedDataGrid>                </RadzenCard>            </RadzenSplitterPane>            <RadzenSplitterPane>                <RadzenCard>                    <RadzenRow class="mb-2">                        <RadzenColumn SizeLG="6" SizeXL="6" SizeMD="6" SizeSM="6" SizeXX="12" SizeXS="12" class="d-flex align-items-end">                            <RadzenText Text="Artículos sin disponible" TextStyle="Radzen.Blazor.TextStyle.H6" TagName="Radzen.Blazor.TagName.Auto" class="p-0 m-0"></RadzenText>                        </RadzenColumn>                        <RadzenColumn SizeLG="6" SizeXL="6" SizeMD="6" SizeSM="6" SizeXX="12" SizeXS="12">                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.End" Gap="1rem" Wrap="FlexWrap.Wrap" JustifyContent="JustifyContent.End">                                <RadzenFormField Variant="Variant.Text">                                    <RadzenDropDown @bind-Value="@ItemsOutOfStockGridTimer.SelectedTimer" Data="@Timers" ValueProperty="Milliseconds" TextProperty="Description" Name="ItemsOutOfStockDropDownTimer" Change="@((args)=>ItemsOutOfStockData_UpdateOnTimerChange(args))" />                                </RadzenFormField>                                <RadzenButton Click="@UpdateItemsOutOfStockAsync" Icon="refresh" Variant="Variant.Filled" ButtonStyle="ButtonStyle.Primary" Size="ButtonSize.Medium" class="d-flex align-items-end rz-button-icon-only rz-border-radius-10" />                            </RadzenStack>                        </RadzenColumn>                    </RadzenRow>                    <LocalizedDataGrid Style="height: 100%" PageSize="@pageSize" @ref="outOfStockArticlesGrid" AllowFiltering="true" AllowPaging="true" AllowSorting="true" ShowPagingSummary="true" Data="@outOfStockArticles" TItem="OutOfStockArticle" IsLoading="@ItemsOutOfStockGridTimer.IsLoading">                        <Columns>                            <RadzenDataGridColumn TItem="OutOfStockArticle" Property="ArticleName" Title="Referencia" Width="80%" />                            <RadzenDataGridColumn TItem="OutOfStockArticle" Title="Inventario" Width="30%" Filterable="false">                                <Template Context="detail">                                    @detail.AvailableQuantity.ToString("N0")                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="OutOfStockArticle" Title="En Tránsito" Width="30%" Filterable="false">                                <Template Context="detail">                                    @detail.InTransitQuantity.ToString("N0")                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="OutOfStockArticle" Title="Reservado" Width="30%" Filterable="false">                                <Template Context="detail">                                    @detail.ReservedQuantity.ToString("N0")                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="OutOfStockArticle" Title="Pedido" Width="30%" Filterable="false">                                <Template Context="detail">                                    @detail.OrderedQuantity.ToString("N0")                                </Template>                            </RadzenDataGridColumn>                        </Columns>                    </LocalizedDataGrid>                </RadzenCard>            </RadzenSplitterPane>        </RadzenSplitter>    </RadzenSplitterPane>    <RadzenSplitterPane Size="50%" Min="20%" Max="80%">        <RadzenSplitter Orientation="Orientation.Horizontal">            <RadzenSplitterPane Size="50%" Min="20%" Max="80%">                <RadzenCard>                    <RadzenRow class="mb-2">                        <RadzenColumn SizeLG="6" SizeXL="6" SizeMD="6" SizeSM="6" SizeXX="12" SizeXS="12" class="d-flex align-items-end">                            <RadzenText Text="Reservas vencidas" TextStyle="Radzen.Blazor.TextStyle.H6" TagName="Radzen.Blazor.TagName.Auto" class="p-0 m-0"></RadzenText>                        </RadzenColumn>                        <RadzenColumn SizeLG="6" SizeXL="6" SizeMD="6" SizeSM="6" SizeXX="12" SizeXS="12">                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.End" Gap="1rem" Wrap="FlexWrap.Wrap" JustifyContent="JustifyContent.End">                                <RadzenFormField Variant="Variant.Text">                                    <RadzenDropDown @bind-Value="@ExpiredReservationsGridTimer.SelectedTimer" Data="@Timers" ValueProperty="Milliseconds" TextProperty="Description" Name="ExpiredReservationsDropDownTimer" Change="@((args)=>ExpiredReservationsData_UpdateOnTimerChange(args))" />                                </RadzenFormField>                                <RadzenButton Click="@UpdateExpiredReservationsAsync" Icon="refresh" Variant="Variant.Filled" ButtonStyle="ButtonStyle.Primary" Size="ButtonSize.Medium" class="d-flex align-items-end rz-button-icon-only rz-border-radius-10" />                            </RadzenStack>                        </RadzenColumn>                    </RadzenRow>                    <LocalizedDataGrid Style="height: 100%" PageSize="@pageSize" @ref="expiredReservationsGrid" AllowFiltering="true" AllowPaging="true" AllowSorting="true" ShowPagingSummary="true" Data="@expiredReservations" TItem="Aldebaran.Application.Services.Models.CustomerReservation" IsLoading="@ExpiredReservationsGridTimer.IsLoading">                        <Columns>                            <RadzenDataGridColumn TItem="Aldebaran.Application.Services.Models.CustomerReservation" Property="ReservationNumber" Title="No. reserva" Width="40%"></RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="Aldebaran.Application.Services.Models.CustomerReservation" Property="Customer.CustomerName" Title="Cliente" Width="80%"></RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="Aldebaran.Application.Services.Models.CustomerReservation" Property="ReservationDate" Title="Fecha reserva" Width="50%">                                <Template Context="customerReservation">                                    <span>@customerReservation.ReservationDate.ToString(SharedLocalizer["date:format"])</span>                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="Aldebaran.Application.Services.Models.CustomerReservation" Property="ExpirationDate" Title="Fecha expiración" Width="50%">                                <Template Context="customerReservation">                                    <span>@customerReservation.ExpirationDate.ToString(SharedLocalizer["date:format"])</span>                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="Aldebaran.Application.Services.Models.CustomerReservation" Filterable="false" Sortable="false" Width="50px" TextAlign="TextAlign.Center" Pickable="false" Reorderable="false" Resizable="false">                                <Template Context="customerReservation">                                    <RadzenButton Icon="document_scanner" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium" Click="@(args => OpenCustomerReservation(customerReservation))" @onclick:stopPropagation="true" MouseEnter="@(args => ShowTooltip(args,"Consultar reserva", new TooltipOptions(){ Position = TooltipPosition.Left }))">                                    </RadzenButton>                                </Template>                            </RadzenDataGridColumn>                        </Columns>                    </LocalizedDataGrid>                </RadzenCard>            </RadzenSplitterPane>            <RadzenSplitterPane>                <RadzenCard>                    <RadzenRow class="mb-2">                        <RadzenColumn SizeLG="6" SizeXL="6" SizeMD="6" SizeSM="6" SizeXX="12" SizeXS="12" class="d-flex align-items-end">                            <RadzenText Text="Alarmas del día" TextStyle="Radzen.Blazor.TextStyle.H6" TagName="Radzen.Blazor.TagName.Auto" class="p-0 m-0"></RadzenText>                        </RadzenColumn>                        <RadzenColumn SizeLG="6" SizeXL="6" SizeMD="6" SizeSM="6" SizeXX="12" SizeXS="12">                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.End" Gap="1rem" Wrap="FlexWrap.Wrap" JustifyContent="JustifyContent.End">                                <RadzenFormField Variant="Variant.Text">                                    <RadzenDropDown @bind-Value="@UserAlarmsGridTimer.SelectedTimer" Data="@Timers" ValueProperty="Milliseconds" TextProperty="Description" Name="UserAlarmsDropDownTimer" Change="@((args)=>UserAlarmsData_UpdateOnTimerChange(args))" />                                </RadzenFormField>                                <RadzenButton Click="@UpdateUserAlarmsAsync" Icon="refresh" Variant="Variant.Filled" ButtonStyle="ButtonStyle.Primary" Size="ButtonSize.Medium" class="d-flex align-items-end rz-button-icon-only rz-border-radius-10" />                            </RadzenStack>                        </RadzenColumn>                    </RadzenRow>                    <LocalizedDataGrid Style="height: 100%" PageSize="@pageSize" @ref="alarmsGrid" AllowFiltering="true" AllowPaging="true" AllowSorting="true" ShowPagingSummary="true" Data="@alarms" TItem="Alarm" IsLoading="@UserAlarmsGridTimer.IsLoading">                        <Columns>                            <RadzenDataGridColumn TItem="Alarm" Title="Documento" Width="80%">                                <Template Context="alarm">                                    <RadzenLabel>                                        @alarm.DocumentTypeName Nro. @alarm.DocumentNumber                                    </RadzenLabel>                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="Alarm" Property="CreationDate" Title="Fecha creación" Width="50%">                                <Template Context="alarm">                                    <span>@alarm.CreationDate.ToString(SharedLocalizer["date:format"])</span>                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="Alarm" Property="ExecutionDate" Title="Fecha activación" Width="50%">                                <Template Context="alarm">                                    <span>@alarm.ExecutionDate.ToString(SharedLocalizer["date:format"])</span>                                </Template>                            </RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="Alarm" Property="AlarmMessage" Title="Mensaje" Width="80%"></RadzenDataGridColumn>                            <RadzenDataGridColumn TItem="Alarm" Filterable="false" Sortable="false" Width="50px" TextAlign="TextAlign.Center" Pickable="false" Reorderable="false" Resizable="false">                                <Template Context="alarm">                                    <RadzenButton Icon="assignment_turned_in" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium" Click="@(args => DisableAlarm(alarm))" @onclick:stopPropagation="true" MouseEnter="@(args => ShowTooltip(args,"Marcar alarma como leída", new TooltipOptions(){ Position = TooltipPosition.Left }))">                                    </RadzenButton>                                </Template>                            </RadzenDataGridColumn>                        </Columns>                    </LocalizedDataGrid>                </RadzenCard>            </RadzenSplitterPane>        </RadzenSplitter>    </RadzenSplitterPane></RadzenSplitter>